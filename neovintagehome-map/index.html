<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retro Map with KML + Custom Markers</title>
<style>
  html, body { height: 100%; margin: 0; padding: 0; }
  #map { width: 100%; height: 100%; }
</style>
</head>
<body>
<div id="map"></div>

<script>
  // 1️⃣ Define initMap early so Google Maps can call it
  window.initMap = function() {
    const retroStyle = [
      { elementType: "geometry", stylers: [{ color: "#ebe3cd" }] },
      { elementType: "labels.text.fill", stylers: [{ color: "#523735" }] },
      { elementType: "labels.text.stroke", stylers: [{ color: "#f5f1e6" }] },
      { featureType: "water", elementType: "geometry.fill", stylers: [{ color: "#b9d3c2" }] }
    ];

    // 2️⃣ Create the map
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 0, lng: 0 },
      zoom: 2,
      styles: retroStyle,
      gestureHandling: "greedy",
      disableDefaultUI: true,
      streetViewControl: true
    });

    // 3️⃣ Add KML layer (visual only, suppress markers)
    new google.maps.KmlLayer({
      url: "https://www.google.com/maps/d/u/0/kml?forcekml=1&mid=1T_TihQ5Qmy_rYiQdrJRSeIUtUOAHq-Q",
      map: map,
      preserveViewport: true,
      suppressInfoWindows: true
    });

    // 4️⃣ Load custom markers from JSON
    fetch('markers.json')
      .then(res => res.json())
      .then(markers => {
        markers.forEach(m => {
          const marker = new google.maps.Marker({
            position: { lat: m.lat, lng: m.lng },
            map: map,
            icon: "https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg",
            title: m.title
          });

          const infoWindow = new google.maps.InfoWindow({ content: m.html });
          marker.addListener('click', () => infoWindow.open(map, marker));
        });
      })
      .catch(err => console.error('Error loading markers.json:', err));
  }
</script>

<!-- 5️⃣ Load Google Maps JS API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAE-A0Irud0EMWOQVANj048sBrgAMSfCV0&callback=initMap&v=weekly" async defer></script>
</body>
</html>
